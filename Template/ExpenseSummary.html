<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hotel Billing System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

{% include 'navbar.html' %}

<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">Daily Expense Summary</h1>

    <!-- Add Expense + Date‚ÄêRange Filter -->
    <div class="d-flex justify-content-between flex-wrap align-items-end mb-5">
      <a href="/accounts/add_expense/" class="btn btn-success mb-3 mb-sm-0">
        + Add Expense
      </a>
      <form method="get" class="row g-3 align-items-end mb-0">
        <div class="col-auto">
          <label for="start_date" class="form-label">Start Date</label>
          <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date }}" />
        </div>
        <div class="col-auto">
          <label for="end_date" class="form-label">End Date</label>
          <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date }}" />
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-primary">üîç Filter</button>
        </div>
      </form>
    </div>

    {% for date, data in summary.items %}
    <div class="table-responsive mb-4">
      <table class="table table-striped">
        <thead class="bg-primary text-white">
          <tr>
            <th colspan="3"><strong>{{ date }}</strong></th>
            <th class="text-end">
              Total Spent: <strong>‚Çπ{{ data.total }}</strong>
            </th>
          </tr>
          <tr>
            <th>Description</th>
            <th>Payment Mode</th>
            <th>Owner</th>
            <th class="text-end">Amount (‚Çπ)</th>
          </tr>
        </thead>
        <tbody>
          {% for expense in data.items %}
          <tr>
            <td>{{ expense.description }}</td>
            <td>{{ expense.payment_mode }}</td>
            <td>{{ expense.owner }}</td>
            <td class="text-end">‚Çπ{{ expense.amount }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% empty %}
    <p class="text-muted">No expenses recorded yet.</p>
    {% endfor %}

  </div>

   <div class="card mb-5">
    <div class="card-body">
      <h5 class="card-title">Monthly Spend</h5>
      <canvas id="monthlySpendChart" height="100"></canvas>
    </div>
  </div>

  <!-- 1. Load Bootstrap JS (if still needed) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- 2. Load Chart.js library BEFORE your chart code -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

  <!-- 3. Your inline chart code -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const labels = {{ monthly_labels|safe }};
      const dataValues = {{ monthly_values|safe }};
      const ctx = document.getElementById('monthlySpendChart').getContext('2d');

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Spent (‚Çπ)',
            data: dataValues,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor:   'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: 'Month' } },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Amount (‚Çπ)' }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: ctx => `‚Çπ${ctx.formattedValue}`
              }
            }
          }
        }
      });
    });
  </script>





  <footer class="bg-dark text-white text-center p-3">
    <p>&copy; 2025 Swad Satva. All rights reserved.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  ></script>

</body>

</html>